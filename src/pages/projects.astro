---
import BaseLayout from "@/layouts/BaseLayout.astro";
import type { iSeoPage } from "@/models/iSeoPage";
import ProjectCard from "@/components/ProjectCard.astro";
import { allProjects } from "@/shared/projectDigest";
import { fetchRepoLanguages } from "@/shared/githubStats";

const pageTitle = "@coins5";
const seoPage: iSeoPage = {
  title: "Projects",
  description:
    "Full stack developer. I create digital experiences with the mind of an engineer and the soul of a builder â€” thoughtful, elegant, and scalable.",
  image:
    "https://media.licdn.com/dms/image/v2/C5603AQH_niCAlkNaLQ/profile-displayphoto-shrink_800_800/profile-displayphoto-shrink_800_800/0/1516870572260?e=1752710400&v=beta&t=sXfVL04zeyjfr-c-r7jS9G5F5i6W_BcCfGK3MqgTH9Q",
};

const ghToken = import.meta.env.GITHUB_TOKEN;
const withLangs = await Promise.all(
  allProjects.map(async (p) => {
    const urlParts = p.data.repo.split("/");
    const [owner, repo] = [urlParts.at(-2)!, urlParts.at(-1)!];
    const languages = await fetchRepoLanguages(owner, repo, ghToken);
    return { ...p, languages };
  })
);
---

<BaseLayout pageTitle={pageTitle} pageSeo={seoPage}>
  <div class="container">
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
      {
        withLangs.map((p) => (
          <ProjectCard project={p.data} languages={p.languages} />
        ))
      }
    </div>
  </div>
</BaseLayout>
