---
import { getCollection } from "astro:content";
import { Image } from "astro:assets";
import BaseLayout from "@/layouts/BaseLayout.astro";
import BlogCard from "@/components/BlogCard.astro";
import SVGArrowIrght from "@/assets/svg/arrow-right.svg";

import { getImage } from "@/shared/imageResolver";

const allPosts = await getCollection("blog");
const allSeries = await getCollection("serie");
const featuredSerie = allSeries.filter((as) => as.data.isFeatured)[0];
const firstEntry = featuredSerie.data.firstEntry;

allPosts.sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf());

const imageSrc = getImage(featuredSerie.data.coverImage!);
const pageTitle = "Coins5's Blog";
---

<BaseLayout pageTitle={pageTitle} readerMode={false}>
  <div class="mb-20 relative flex justify-center">
    <Image
      src={imageSrc}
      alt="Blog background"
      class="absolute inset-0 w-full h-120 object-cover"
    />

    <div class="relative px-10 py-32 max-w-lg">
      <h1 class="text-white uppercase text-4xl font-bold leading-loose">
        <span class="bg-gray-900 box-decoration-clone px-2 py-1">
          {featuredSerie.data.name}
        </span>
      </h1>
      <div class="card-actions justify-end">
        <a
          href={`/posts/${firstEntry.id}`}
          class="btn btn-primary uppercase p-6"
        >
          Read more <SVGArrowIrght height="24px" /></a
        >
      </div>
    </div>
  </div>

  <div class="container grid grid-cols-1 md:grid-cols-2 2xl:grid-cols-3 gap-12">
    {allPosts.map((post) => <BlogCard entry={post} />)}
  </div>
</BaseLayout>
